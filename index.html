<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Harbin & Arxan 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #E6EEF5 0%, #F0F4F8 100%);
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.9);
            --primary-dark: #2C3E50;
            --secondary-grey: #64748B;
            --accent-blue: #5D8AA8; /* åŒ—æ­å³½ç£è— */
            --accent-warm: #D4A373; /* æš–æœ¨è‰² (ç¾é£Ÿ/æé†’) */
            --shadow-soft: 0 8px 30px rgba(0,0,0,0.04);
            --shadow-card: 0 4px 12px rgba(93, 138, 168, 0.08);
            --radius-box: 24px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background: var(--bg-gradient);
            color: var(--primary-dark);
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden; /* é˜²æ­¢æ•´é«”æ²å‹•ï¼Œè®“ä¸­é–“å€åŸŸæ²å‹• */
        }

        /* --- UI Components --- */
        
        /* é ‚éƒ¨å°èˆª */
        .app-header {
            padding: 20px 24px;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.5);
        }
        .header-title { font-size: 18px; font-weight: 700; letter-spacing: 0.5px; color: var(--primary-dark); }
        .header-status { font-size: 10px; color: var(--accent-blue); background: rgba(93, 138, 168, 0.1); padding: 4px 10px; border-radius: 20px; font-weight: 600; }

        /* ä¸»å…§å®¹å€ (å¯æ»‘å‹•) */
        .main-content {
            height: 100%;
            padding: 90px 20px 100px 20px; /* é¿é–‹é ­å°¾ */
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        /* éš±è— Scrollbar ä½†ä¿æŒæ»‘å‹• */
        .main-content::-webkit-scrollbar { display: none; }

        /* æ—¥æœŸå°èˆª (Day Pagination) */
        .day-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
            gap: 20px;
        }
        .btn-page {
            background: white;
            border: none;
            width: 40px; height: 40px;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            color: var(--primary-dark);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .btn-page:active { transform: scale(0.95); background: var(--accent-blue); color: white; }
        .current-date-display {
            text-align: center;
        }
        .date-big { font-size: 20px; font-weight: 800; color: var(--primary-dark); }
        .date-loc { font-size: 13px; color: var(--secondary-grey); margin-top: 2px; }

        /* å¤©æ°£è† å›Š */
        .weather-pill {
            background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 16px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 8px 20px rgba(102, 166, 255, 0.25);
            font-weight: 500;
        }

        /* å¡ç‰‡è¨­è¨ˆ (Glassmorphism) */
        .event-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-box);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-card);
            position: relative;
            transition: transform 0.2s;
        }
        .event-card:active { transform: scale(0.99); }
        
        .tag-line {
            width: 40px; height: 4px; border-radius: 4px; margin-bottom: 12px;
        }
        .type-transport .tag-line { background: var(--accent-blue); }
        .type-view .tag-line { background: #52B788; }
        .type-food .tag-line { background: var(--accent-warm); }
        .type-stay .tag-line { background: #9D84B7; }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .card-title { font-size: 17px; font-weight: 700; margin: 0; color: var(--primary-dark); }
        .card-time { 
            font-size: 12px; 
            font-weight: 600; 
            color: var(--secondary-grey); 
            background: #F1F5F9; 
            padding: 4px 10px; 
            border-radius: 12px; 
        }

        .card-desc { font-size: 14px; color: #4B5563; line-height: 1.6; margin-bottom: 15px; }

        /* å°éŠèªªæ•…äº‹ (Story Section) */
        .story-box {
            background: #FDFBF7;
            border-left: 3px solid var(--accent-warm);
            padding: 12px 15px;
            border-radius: 0 12px 12px 0;
            margin: 10px -20px 15px -20px; /* æ‹‰æ»¿å¯¬åº¦ */
            padding-left: 20px;
            position: relative;
        }
        .story-label { font-size: 11px; font-weight: 700; color: var(--accent-warm); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; display: block;}
        .story-text { font-size: 13px; color: #5D5D5D; font-style: italic; line-height: 1.5; }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        .action-row { display: flex; gap: 10px; margin-top: 15px; }
        .btn-map {
            flex: 1;
            padding: 10px;
            border-radius: 12px;
            background: #EFF6FF;
            color: #2563EB;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .btn-check {
            width: 40px;
            border-radius: 12px;
            background: white;
            border: 1px solid #E5E7EB;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px;
            cursor: pointer;
            color: #ccc;
        }
        .btn-check.checked { color: #EF4444; border-color: #FECACA; background: #FEF2F2; }

        /* è¨˜å¸³èˆ‡è³‡è¨Šé é¢å„ªåŒ– */
        .info-card { background: white; border-radius: 16px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); display: flex; justify-content: space-between; align-items: center;}
        .info-main { font-weight: 600; color: var(--primary-dark); }
        .info-sub { font-size: 12px; color: var(--secondary-grey); margin-top: 4px; }
        .flight-badge { background: var(--primary-dark); color: white; padding: 2px 6px; border-radius: 4px; font-size: 11px; margin-right: 6px; }

        /* åº•éƒ¨å°èˆª */
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 20px; right: 20px;
            height: 65px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 200;
        }
        .nav-item {
            text-align: center;
            color: #94A3B8;
            font-size: 24px;
            padding: 10px 20px;
            border-radius: 16px;
            transition: all 0.3s;
        }
        .nav-item.active {
            color: var(--accent-blue);
            transform: translateY(-5px);
            background: rgba(93, 138, 168, 0.1);
        }
        .nav-label { font-size: 9px; display: block; font-weight: 600; margin-top: 2px; }

        /* éš±è—/é¡¯ç¤ºæ§åˆ¶ */
        .page-section { display: none; animation: fadeIn 0.4s ease; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

<header class="app-header">
    <div class="header-title">Northern Lights '25</div>
    <div class="header-status" id="connection-status">â— é€£ç·šä¸­</div>
</header>

<div class="main-content">

    <div id="view-itinerary" class="page-section active">
        <div class="day-pagination">
            <button class="btn-page" onclick="changeDay(-1)">â®</button>
            <div class="current-date-display">
                <div class="date-big" id="display-date">Dec 24</div>
                <div class="date-loc" id="display-loc">Shanghai</div>
            </div>
            <button class="btn-page" onclick="changeDay(1)">â¯</button>
        </div>

        <div class="weather-pill">
            <span>â„ï¸ ç•¶åœ°å¤©æ°£é å ±</span>
            <span id="display-weather" style="font-weight:700">-Â°C</span>
        </div>

        <div id="day-events-list">
            </div>
        
        <div style="height: 20px;"></div>
    </div>

    <div id="view-info" class="page-section">
        <h2 style="margin:10px 0 20px 0; font-size:20px;">èˆªç­èˆ‡äº¤é€š</h2>
        <div class="info-card">
            <div>
                <div class="info-main"><span class="flight-badge">CA196</span>å°åŒ— TPE â ä¸Šæµ· PVG</div>
                <div class="info-sub">12/24 15:05 - 17:10 | ä¸­åœ‹åœ‹éš›èˆªç©º</div>
            </div>
        </div>
        <div class="info-card">
            <div>
                <div class="info-main"><span class="flight-badge">CA8301</span>ä¸Šæµ· PVG â å“ˆçˆ¾æ¿± HRB</div>
                <div class="info-sub">12/25 07:00 - 10:00 | é è¨ˆèˆªç­</div>
            </div>
        </div>
        <div class="info-card">
            <div>
                <div class="info-main"><span class="flight-badge">CA8514</span>å“ˆçˆ¾æ¿± HRB â æ­å· HGH</div>
                <div class="info-sub">12/29 19:20 - 22:40 | ä¸­åœ‹åœ‹éš›èˆªç©º</div>
            </div>
        </div>
        <div class="info-card">
            <div>
                <div class="info-main"><span class="flight-badge">CA149</span>æ­å· HGH â å°åŒ— TPE</div>
                <div class="info-sub">12/30 09:30 - 11:25 | ä¸­åœ‹åœ‹éš›èˆªç©º</div>
            </div>
        </div>

        <h2 style="margin:30px 0 20px 0; font-size:20px;">ç«è»Šè³‡è¨Š</h2>
        <div class="info-card">
            <div>
                <div class="info-main">ğŸš… G1238 é«˜éµ</div>
                <div class="info-sub">12/25 11:57 å“ˆçˆ¾æ¿±è¥¿ - 14:31 ç€‹é™½åŒ—</div>
            </div>
        </div>
        <div class="info-card">
            <div>
                <div class="info-main">ğŸš‚ K7565 è‡¥é‹ª</div>
                <div class="info-sub">12/25 21:09 ç€‹é™½ - 12/26 09:17 é˜¿çˆ¾å±±</div>
            </div>
        </div>
         <div class="info-card">
            <div>
                <div class="info-main">ğŸš‚ K7090 è‡¥é‹ª</div>
                <div class="info-sub">12/27 20:50 æ»¿æ´²é‡Œ - 12/28 09:05 å“ˆçˆ¾æ¿±</div>
            </div>
        </div>
    </div>

    <div id="view-budget" class="page-section">
        <h2 style="margin:10px 0 20px 0; font-size:20px;">æ—…è²»è¨˜å¸³</h2>
        <div class="weather-pill" style="background:linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%); color:#333;">
            <span>ç›®å‰ç¸½æ”¯å‡º</span>
            <span style="font-size:20px;">Â¥<span id="total-amount">0</span></span>
        </div>
        
        <div style="background:white; padding:20px; border-radius:24px; box-shadow:var(--shadow-card);">
            <input type="text" id="expense-who" placeholder="ä»˜æ¬¾äºº (å¦‚: æˆ‘)" style="width:100%; padding:12px; border:1px solid #eee; border-radius:12px; margin-bottom:10px; outline:none;">
            <input type="text" id="expense-name" placeholder="é …ç›® (å¦‚: æ™šé¤)" style="width:100%; padding:12px; border:1px solid #eee; border-radius:12px; margin-bottom:10px; outline:none;">
            <input type="number" id="expense-amount" placeholder="é‡‘é¡ (RMB)" style="width:100%; padding:12px; border:1px solid #eee; border-radius:12px; margin-bottom:15px; outline:none;">
            <button id="btn-add-expense" style="width:100%; padding:14px; background:var(--primary-dark); color:white; border:none; border-radius:12px; font-weight:bold;">ï¼‹ è¨˜ä¸€ç­†</button>
        </div>

        <div id="expense-list" style="margin-top:20px;"></div>
    </div>

    <div id="view-chat" class="page-section">
        <div style="background:white; padding:15px; border-radius:20px; position:sticky; top:0; z-index:10; box-shadow:var(--shadow-card);">
            <input type="text" id="chat-user" placeholder="ä½ çš„åå­—" style="width:100%; margin-bottom:10px; padding:8px; border:1px solid #eee; border-radius:8px;">
            <div style="display:flex; gap:10px;">
                <input type="text" id="chat-msg" placeholder="è¼¸å…¥ç•™è¨€..." style="flex:1; padding:8px; border:1px solid #eee; border-radius:8px;">
                <button id="btn-send-msg" style="padding:8px 15px; background:var(--accent-blue); color:white; border:none; border-radius:8px;">ç™¼é€</button>
            </div>
        </div>
        <div id="chat-list" style="margin-top:20px; padding-bottom:50px;"></div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchView('itinerary', this)">
        <i class="icon">ğŸ—ºï¸</i>
        <span class="nav-label">è¡Œç¨‹</span>
    </div>
    <div class="nav-item" onclick="switchView('info', this)">
        <i class="icon">ğŸ«</i>
        <span class="nav-label">è³‡è¨Š</span>
    </div>
    <div class="nav-item" onclick="switchView('budget', this)">
        <i class="icon">ğŸ’°</i>
        <span class="nav-label">è¨˜å¸³</span>
    </div>
    <div class="nav-item" onclick="switchView('chat', this)">
        <i class="icon">ğŸ’¬</i>
        <span class="nav-label">ç•™è¨€</span>
    </div>
</nav>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, Timestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // âš ï¸ ä½ çš„ Firebase Config (ç¶­æŒä¸è®Š)
    const firebaseConfig = {
      apiKey: "AIzaSyCTN4SxbLj5j_pVL9AlL899Ockn_cUryq4",
      authDomain: "harbin-trip-2025.firebaseapp.com",
      projectId: "harbin-trip-2025",
      storageBucket: "harbin-trip-2025.firebasestorage.app",
      messagingSenderId: "23165691648",
      appId: "1:23165691648:web:06ba8482fabf449b7735e5",
      measurementId: "G-SJWGZFTV0F"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    // é€£ç·šç‹€æ…‹
    document.getElementById('connection-status').innerText = "â— å·²é€£ç·š";
    document.getElementById('connection-status').style.color = "#27AE60";

    // --- Firebase è¨˜å¸³ ---
    const expenseListEl = document.getElementById('expense-list');
    const totalAmountEl = document.getElementById('total-amount');
    
    onSnapshot(query(collection(db, "expenses"), orderBy("timestamp", "desc")), (snapshot) => {
        let html = '';
        let total = 0;
        snapshot.forEach((docSnap) => {
            const data = docSnap.data();
            total += Number(data.amount);
            html += `
                <div style="display:flex; justify-content:space-between; padding:12px; border-bottom:1px solid #eee; align-items:center;">
                    <div>
                        <div style="font-weight:600; color:#333;">${data.name}</div>
                        <div style="font-size:12px; color:#888;">${data.who} â€¢ Â¥${data.amount}</div>
                    </div>
                    <span class="delete-btn" data-id="${docSnap.id}" style="color:#ff6b6b; font-size:12px; cursor:pointer; padding:5px;">âœ•</span>
                </div>`;
        });
        expenseListEl.innerHTML = html;
        totalAmountEl.innerText = total;

        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', async (e) => {
                if(confirm('åˆªé™¤æ­¤ç­†æ”¯å‡ºï¼Ÿ')) await deleteDoc(doc(db, "expenses", e.target.dataset.id));
            });
        });
    });

    document.getElementById('btn-add-expense').addEventListener('click', async () => {
        const who = document.getElementById('expense-who').value;
        const name = document.getElementById('expense-name').value;
        const amount = document.getElementById('expense-amount').value;
        if(who && name && amount) {
            await addDoc(collection(db, "expenses"), { who, name, amount: Number(amount), timestamp: Timestamp.now() });
            document.getElementById('expense-name').value = '';
            document.getElementById('expense-amount').value = '';
        }
    });

    // --- Firebase ç•™è¨€ ---
    const chatListEl = document.getElementById('chat-list');
    onSnapshot(query(collection(db, "messages"), orderBy("timestamp", "asc")), (snapshot) => {
        let html = '';
        snapshot.forEach((docSnap) => {
            const data = docSnap.data();
            const date = data.timestamp ? new Date(data.timestamp.toDate()) : new Date();
            html += `
                <div style="background:white; padding:10px; border-radius:12px; margin-bottom:8px; box-shadow:0 2px 5px rgba(0,0,0,0.03);">
                    <div style="font-size:11px; color:#5D8AA8; font-weight:bold;">${data.user} <span style="font-weight:normal; color:#ccc; margin-left:5px;">${date.getHours()}:${String(date.getMinutes()).padStart(2,'0')}</span></div>
                    <div style="font-size:14px; color:#333; margin-top:2px;">${data.msg}</div>
                </div>`;
        });
        chatListEl.innerHTML = html;
        window.scrollTo(0, document.body.scrollHeight);
    });

    document.getElementById('btn-send-msg').addEventListener('click', async () => {
        const user = document.getElementById('chat-user').value || 'åŒ¿å';
        const msg = document.getElementById('chat-msg').value;
        if(msg) {
            await addDoc(collection(db, "messages"), { user, msg, timestamp: Timestamp.now() });
            document.getElementById('chat-msg').value = '';
        }
    });
</script>

<script>
    // --- V2.0 äº’å‹•è¡Œç¨‹è³‡æ–™çµæ§‹ (å«æ•…äº‹ã€èˆªç­ã€é«˜å¾·åœ°åœ–) ---
    const itineraryData = [
        {
            date: "12/24", location: "å°åŒ— âœˆï¸ ä¸Šæµ·", weather: "â˜ï¸ 5~10Â°C",
            events: [
                { 
                    type: "transport", title: "CA196 é£›å¾€ä¸Šæµ·", time: "15:05 TPE - 17:10 PVG", 
                    desc: "æŠµé”ä¸Šæµ·æµ¦æ±æ©Ÿå ´ï¼Œæº–å‚™é–‹å§‹æ—…ç¨‹ã€‚", nav: "ä¸Šæµ·æµ¦æ±åœ‹éš›æ©Ÿå ´" 
                },
                { 
                    type: "view", title: "å¤–ç˜ & å—äº¬æ­¥è¡Œè¡—", time: "æ™šä¸Š", 
                    desc: "é­”éƒ½ç¶“å…¸å¤œæ™¯ã€‚è¬åœ‹å»ºç¯‰ç¾¤æ˜¯ä¸Šæµ·ç§Ÿç•Œæ™‚æœŸçš„æ­·å²è¦‹è­‰ã€‚", 
                    story: "å°éŠèªªï¼šé€™è£¡æ›¾ç¶“æ˜¯è‹±åœ‹ç§Ÿç•Œï¼Œå»ºç¯‰é¢¨æ ¼æ¶µè“‹äº†å·´æ´›å…‹ã€å“¥å¾·å¼ç­‰52å¹¢å¤§æ¨“ï¼Œè¢«ç¨±ç‚ºã€è¬åœ‹å»ºç¯‰åšè¦½ç¾¤ã€ã€‚æ™šä¸Šé–‹ç‡ˆå¾Œï¼Œé‡‘è‰²å…‰èŠ’å€’æ˜ åœ¨é»ƒæµ¦æ±Ÿæœ€ç¾ã€‚",
                    nav: "ä¸Šæµ·å¤–ç˜" 
                },
                { 
                    type: "food", title: "æ™šé¤ï¼šå°æ¥Šç”Ÿç… & èŸ¹é»ƒéºµ", time: "æ™šé¤æ¨è–¦", 
                    desc: "ä¸Šæµ·å¿…åƒå°åƒï¼Œçš®è–„åº•è„†ï¼Œæ¹¯æ±çˆ†ç‚¸ã€‚", 
                    story: "ç¾é£Ÿæ”»ç•¥ï¼šåƒç”Ÿç…åŒ…è¦ã€å…ˆé–‹çª—ã€å¾Œå–æ¹¯ã€ï¼Œä¸ç„¶æœƒè¢«ç†±æ¹¯ç‡™åˆ°å˜´å–”ï¼æ¨è–¦æ­é…ä¸€ç¢—ç‰›è‚‰ç²‰çµ²æ¹¯ã€‚",
                    nav: "å°æ¥Šç”Ÿç…" 
                },
                {
                    type: "food", title: "Speak Low (é…’å§)", time: "20:00",
                    desc: "Asia Top 50 Barï¼Œéš±è—åœ¨æ›¸åº—æ©Ÿé—œå¾Œçš„é…’å§ã€‚",
                    story: "å°è¶£èï¼šé€™å®¶åº—é–€å£è³£é…’å…·å’Œæ›¸ï¼Œä½ éœ€è¦æ‰¾åˆ°æ›¸æ«ƒä¸Šçš„æ©Ÿé—œæ‰èƒ½é€²å…¥çœŸæ­£çš„é…’å§å€åŸŸï¼Œéå¸¸æœ‰ç‰¹å‹™æ„Ÿï¼",
                    nav: "Speak Low"
                }
            ]
        },
        {
            date: "12/25", location: "ä¸Šæµ· âœˆï¸ å“ˆçˆ¾æ¿± ğŸš„ ç€‹é™½", weather: "â„ï¸ -15Â°C",
            events: [
                { type: "transport", title: "CA8301 é£›å¾€å“ˆçˆ¾æ¿±", time: "07:00 PVG - 10:00 HRB", desc: "æ—©ç­æ©Ÿå‰å¾€å†°åŸã€‚", nav: "å“ˆçˆ¾æ¿±å¤ªå¹³åœ‹éš›æ©Ÿå ´" },
                { type: "transport", title: "G1238 é«˜éµå¾€ç€‹é™½", time: "11:57 - 14:31", desc: "å¿«é€Ÿç§»å‹•åˆ°ç€‹é™½ï¼Œæº–å‚™æ™šä¸Šè½‰è»Šã€‚", nav: "å“ˆçˆ¾æ¿±è¥¿ç«™" },
                { 
                    type: "view", title: "æ²é‡Œæ²å¤– (æ´—æµ´é«”é©—)", time: "ä¸‹åˆ", 
                    desc: "åœ¨æ±åŒ—ï¼Œæ´—æ¾¡æ˜¯ä¸€ç¨®æ–‡åŒ–ã€‚åŒ…å«æ“æ¾¡ã€æ¡‘æ‹¿ã€åƒæ°´æœè‡ªåŠ©ã€‚", 
                    story: "æ–‡åŒ–é«”é©—ï¼šæ±åŒ—äººæ‹›å¾…æœ€å¥½çš„æœ‹å‹å°±æ˜¯ã€è«‹ä½ å»æ´—æ¾¡ã€ã€‚è¨˜å¾—é«”é©—ä¸€ä¸‹ã€å¥¶æ“ã€ï¼Œçš®è†šæœƒè®Šè¶…ç´šæ»‘ï¼",
                    nav: "ç€‹é™½æ²é‡Œæ²å¤–" 
                },
                { type: "stay", title: "K7565 è‡¥é‹ªç«è»Š", time: "21:09 å‡ºç™¼", desc: "å‰å¾€é˜¿çˆ¾å±±ï¼Œç¡ä¸€è¦ºå°±åˆ°é›ªåœ‹ã€‚", nav: "ç€‹é™½ç«™" }
            ]
        },
        {
            date: "12/26", location: "é˜¿çˆ¾å±± (é›ªåœ‹)", weather: "â„ï¸ -30Â°C",
            events: [
                { 
                    type: "view", title: "é˜¿çˆ¾å±±åœ‹å®¶æ£®æ—å…¬åœ’", time: "å…¨å¤©", 
                    desc: "é§å³°å¶ºå¤©æ± ã€çŸ³å¡˜æ—ã€‚ä¸­åœ‹æœ€å°çš„åŸå¸‚ï¼Œå»æœ‰æœ€ç¾çš„é›ªæ™¯ã€‚", 
                    story: "åœ°ç†å°çŸ¥è­˜ï¼šé€™è£¡ä½æ–¼å¤§èˆˆå®‰å¶ºè¥¿å—éº“ï¼Œã€é˜¿çˆ¾å±±ã€å…¶å¯¦æ˜¯è’™å¤èªã€ç†±çš„è–æ°´ã€çš„æ„æ€ï¼Œé›–ç„¶ç¾åœ¨å†·å¾—è¦æ­»ï¼Œä½†åœ°ä¸‹å…¨æ˜¯æº«æ³‰å–”ï¼",
                    nav: "é˜¿çˆ¾å±±åœ‹å®¶æ£®æ—å…¬åœ’" 
                },
                { 
                    type: "view", title: "ä¸å‡æ²³ (åš´å†¬å¥‡è§€)", time: "ä¸‹åˆ", 
                    desc: "å³ä½¿é›¶ä¸‹40åº¦ä¹Ÿä¸çµå†°çš„æ²³æµï¼Œç‰›ç¾¤æœƒåœ¨æ²³è£¡åƒè‰ã€‚", 
                    story: "ç‚ºä»€éº¼ä¸çµå†°ï¼Ÿå› ç‚ºæ²³æ®µä¸‹æ–¹æœ‰è±å¯Œçš„åœ°ç†±è³‡æºæ´»å‹•ï¼Œèˆ‡å‘¨åœç™½é›ªå½¢æˆå¼·çƒˆå°æ¯”ï¼Œé‹æ°£å¥½é‚„èƒ½çœ‹åˆ°ã€éœ§å‡‡ã€ã€‚",
                    nav: "é˜¿çˆ¾å±±ä¸å‡æ²³" 
                }
            ]
        },
        {
            date: "12/27", location: "é˜¿çˆ¾å±± â æ»¿æ´²é‡Œ", weather: "â„ï¸ -25Â°C",
            events: [
                { 
                    type: "view", title: "è—æˆ¿å­ & å‘¼å€«æ¹–", time: "ä¸Šåˆ", 
                    desc: "ç¶²ç´…æ‰“å¡é»ã€è—æˆ¿å­ã€ï¼Œåœ¨ä¸€ç‰‡ç™½é›ªä¸­éå¸¸å‡ºç‰‡ã€‚", 
                    story: "æ‹ç…§Tipsï¼šç©¿ç´…è‰²æˆ–é®®è±”çš„è¡£æœï¼Œåœ¨å…¨ç™½èƒŒæ™¯å’Œè—æˆ¿å­å‰æœƒéå¸¸å¥½çœ‹ï¼å‘¼å€«æ¹–æ˜¯å…§è’™å¤ç¬¬ä¸€å¤§æ¹–ï¼Œå†¬å¤©æœƒè®Šæˆè¶…å¤§çš„ã€è—å†°ã€å†°å ´ã€‚",
                    nav: "å‘¼å€«æ¹–" 
                },
                { 
                    type: "view", title: "æ»¿æ´²é‡Œåœ‹é–€ & å¥—å¨ƒå»£å ´", time: "å‚æ™š", 
                    desc: "ä¸­ä¿„é‚Šå¢ƒåŸå¸‚ï¼Œæ»¿è¡—éƒ½æ˜¯ä¿„ç¾…æ–¯å»ºç¯‰ã€‚", 
                    story: "åŸå¸‚æ•…äº‹ï¼šé€™è£¡ä¸€åŠæ˜¯ä¸­åœ‹äººï¼Œä¸€åŠæ˜¯ä¿„ç¾…æ–¯äººã€‚æ™šä¸Šçš„æ»¿æ´²é‡Œé–‹ç‡ˆå¾Œé‡‘ç¢§è¼ç…Œï¼Œè¢«ç¨±ç‚ºã€æ±äºä¹‹çª—ã€ã€‚",
                    nav: "æ»¿æ´²é‡Œå¥—å¨ƒå»£å ´" 
                },
                { 
                    type: "food", title: "ç›§å¸ƒé‡Œè¥¿é¤å»³", time: "æ™šé¤", 
                    desc: "æ­£å®—ä¿„å¼è¥¿é¤ã€‚ç´…èœæ¹¯ã€ç½ç‡œç‰›è‚‰ã€å¤§è‚‰ä¸²ã€‚", 
                    story: "å¿…åƒæ¨è–¦ï¼šä»–å€‘çš„ã€å¥¶é…ªéºµåŒ…ã€éå¸¸é¦™ï¼Œé…ä¸Šé…¸ç”œçš„ç´…èœæ¹¯å‰›å‰›å¥½ã€‚é¤å»³æœå‹™å“¡å¾ˆå¤šéƒ½æ˜¯ä¿„ç¾…æ–¯å¸¥å“¥ç¾å¥³å–”ã€‚",
                    nav: "ç›§å¸ƒé‡Œè¥¿é¤å»³" 
                },
                 { type: "transport", title: "K7090 è‡¥é‹ªç«è»Š", time: "20:50 å‡ºç™¼", desc: "ç¡å›å“ˆçˆ¾æ¿±ã€‚", nav: "æ»¿æ´²é‡Œç«™" }
            ]
        },
        {
            date: "12/28", location: "å“ˆçˆ¾æ¿± (æ±æ–¹è«æ–¯ç§‘)", weather: "â„ï¸ -20Â°C",
            events: [
                { 
                    type: "view", title: "è–ç´¢è²äºå¤§æ•™å ‚", time: "ä¸Šåˆ", 
                    desc: "æ‹œå åº­é¢¨æ ¼å»ºç¯‰ï¼Œå“ˆçˆ¾æ¿±çš„åœ°æ¨™ã€‚", 
                    story: "æ­·å²èª²ï¼šé€™åº§æ•™å ‚å§‹å»ºæ–¼1907å¹´ï¼Œæœ€åˆæ˜¯æ²™ä¿„è»éšŠçš„éš¨è»æ•™å ‚ã€‚å®ƒæ˜¯ç›®å‰ä¸­åœ‹ä¿å­˜æœ€å®Œç¾çš„æ‹œå åº­å¼å»ºç¯‰ï¼Œç¶ è‰²çš„æ´‹è”¥é ­ç©¹é ‚éå¸¸ç¶“å…¸ã€‚",
                    nav: "è–ç´¢è²äºå¤§æ•™å ‚" 
                },
                { 
                    type: "view", title: "å†°é›ªå¤§ä¸–ç•Œ", time: "15:00 - 20:00", 
                    desc: "ä¸–ç•Œæœ€å¤§çš„å†°é›ªæ¨‚åœ’ï¼Œå¿…ç©æ¥µé€Ÿå¤§æ»‘æ¢¯ã€‚", 
                    story: "æ”»ç•¥ï¼šå»ºè­°ä¸‹åˆ3é»é€²å ´ï¼Œå¯ä»¥åŒæ™‚çœ‹åˆ°ç™½å¤©çš„å†°é›•å’Œæ™šä¸Šçš„ç‡ˆå…‰ç§€ã€‚å¦‚æœä¸ç©å¤§æ»‘æ¢¯ï¼ˆæ’éšŠå¾ˆä¹…ï¼‰ï¼Œå¯ä»¥å»è·³ã€è¬äººé›ªåœ°è¹¦è¿ªã€ï¼",
                    nav: "å“ˆçˆ¾æ¿±å†°é›ªå¤§ä¸–ç•Œ" 
                },
                { 
                    type: "food", title: "ä¸­å¤®å¤§è¡— & é¦¬è¿­çˆ¾å†°æ£", time: "æ•£æ­¥", 
                    desc: "è¸©åœ¨ç™¾å¹´éºµåŒ…çŸ³ä¸Šï¼Œè¶Šå†·è¶Šè¦åƒå†°æ£’ã€‚", 
                    story: "å†·çŸ¥è­˜ï¼šä¸­å¤®å¤§è¡—çš„çŸ³é ­æ˜¯èŠ±å´—å²©é‹ªçš„ï¼Œæ“šèªªç•¶å¹´ä¸€å¡ŠçŸ³é ­åƒ¹å€¼ä¸€ç¾å…ƒï¼é¦¬è¿­çˆ¾å†°æ£æ²’æœ‰åŒ…è£ç´™ï¼Œå¥¶å‘³è¶…ç´šæ¿ƒéƒã€‚",
                    nav: "ä¸­å¤®å¤§è¡—" 
                }
            ]
        },
         {
            date: "12/29", location: "å“ˆçˆ¾æ¿± âœˆï¸ æ­å·", weather: "â˜ï¸",
            events: [
                { type: "view", title: "ç´…å°ˆè¡—æ—©å¸‚", time: "06:00", desc: "é«”é©—æ±åŒ—æœ€æ¥åœ°æ°£çš„æ—©æ™¨ï¼Œç‰©åƒ¹æ„Ÿäººã€‚", story: "å¿…åƒï¼šæ²¹ç‚¸ç³•ã€è›‹å ¡ã€å¤§ç¢´ç²¥ã€‚åœ¨é€™è£¡10å¡ŠéŒ¢èƒ½åƒåˆ°æ’ï¼", nav: "ç´…å°ˆè¡—æ—©å¸‚" },
                { type: "transport", title: "CA8514 é£›å¾€æ­å·", time: "19:20 HRB - 22:40 HGH", desc: "å‘Šåˆ¥æ±åŒ—ï¼Œé£›å¾€æ±Ÿå—ã€‚", nav: "å“ˆçˆ¾æ¿±å¤ªå¹³åœ‹éš›æ©Ÿå ´" }
            ]
        },
        {
            date: "12/30", location: "æ­å· âœˆï¸ å°åŒ—", weather: "â˜ï¸ 10Â°C",
            events: [
                 { type: "transport", title: "CA149 å›å®¶", time: "09:30 HGH - 11:25 TPE", desc: "å¸¶è‘—æ»¿æ»¿çš„å›æ†¶å›å®¶å›‰ï¼", nav: "æ­å·è•­å±±åœ‹éš›æ©Ÿå ´" }
            ]
        }
    ];

    // --- æ ¸å¿ƒé‚è¼¯ ---
    let currentDayIndex = 0;

    function renderDay() {
        const dayData = itineraryData[currentDayIndex];
        const container = document.getElementById('day-events-list');
        
        // æ›´æ–°æ¨™é¡Œ
        document.getElementById('display-date').innerText = dayData.date;
        document.getElementById('display-loc').innerText = dayData.location;
        document.getElementById('display-weather').innerText = dayData.weather;
        
        // ç”Ÿæˆå¡ç‰‡
        let html = '';
        dayData.events.forEach((ev, idx) => {
            // Story å€å¡Š
            let storyHtml = ev.story ? `
                <div class="story-box">
                    <span class="story-label">ğŸ‘©â€ğŸ« å°éŠæ‚„æ‚„è©±</span>
                    <span class="story-text">${ev.story}</span>
                </div>` : '';
            
            // é«˜å¾·åœ°åœ–é€£çµ (Web Search Link)
            let amapLink = `https://uri.amap.com/search?keyword=${encodeURIComponent(ev.nav)}`;

            html += `
                <div class="event-card type-${ev.type}">
                    <div class="tag-line"></div>
                    <div class="card-header">
                        <h3 class="card-title">${ev.title}</h3>
                        <span class="card-time">${ev.time}</span>
                    </div>
                    <div class="card-desc">${ev.desc}</div>
                    ${storyHtml}
                    
                    <div class="action-row">
                        <a href="${amapLink}" target="_blank" class="btn-map">
                            ğŸ“ é«˜å¾·å°èˆª
                        </a>
                        <button class="btn-check" onclick="toggleCheck(this)">â™¥</button>
                    </div>
                </div>
            `;
        });
        container.innerHTML = html;
        
        // å‹•ç•«é‡ç½®
        container.style.opacity = 0;
        setTimeout(() => { container.style.opacity = 1; container.style.transition = 'opacity 0.3s'; }, 50);
    }

    // åˆ‡æ›æ—¥æœŸ
    window.changeDay = function(delta) {
        let newIndex = currentDayIndex + delta;
        if(newIndex >= 0 && newIndex < itineraryData.length) {
            currentDayIndex = newIndex;
            renderDay();
        }
    }

    // æ„›å¿ƒæ‰“å¡
    window.toggleCheck = function(btn) {
        btn.classList.toggle('checked');
    }

    // åº•éƒ¨ Tab åˆ‡æ›
    window.switchView = function(viewId, el) {
        document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
        document.getElementById('view-'+viewId).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    // åˆå§‹åŒ–
    renderDay();

</script>
</body>
</html>
